----------------------------------------------------------------
----------------------------------------------------------------

　「PmxTailor　ローカル版」

　　ver2.01.00

　　　　　　　　　　　　　　　　　miu200521358

----------------------------------------------------------------
----------------------------------------------------------------


　この度は拙作をDLしていただき、ありがとうございます。
　お手数ですが以下をご確認のうえ、ご利用ください。

----------------------------------------------------------------


----------------------------------------------------------------
■　概要
----------------------------------------------------------------

　指定した材質に任意の物理を設定するツールです。

　物理の設定をスライダーパラメーターで調整できます
　（直接剛体等の値を調整することも可能です）

　下記材質にも物理を割り当てる事ができます
　　・プリーツ形状の材質
　　・複数のスリットがある材質
　　・裾にフリル等細かいポリ割りがある材質
　　・裏面や厚みのある材質


----------------------------------------------------------------
■　配布動画
----------------------------------------------------------------

■　【MMD】布っぽい物理を入れられるツールを作ってみた【ツール配布】【PmxTailor ver1.00】
https://www.nicovideo.jp/watch/sm39696512
https://youtu.be/yOCPhRNFE2k

■　【MMD】MMDでクロスシミュできるツールを簡単にしてみた【ツール配布】【PmxTailor ver2.00】
https://www.nicovideo.jp/watch/sm40783084
https://youtu.be/aQ70AHE8Rdo

----------------------------------------------------------------
■　同梱ファイル
----------------------------------------------------------------

　・PmxTailor2.01.00.exe　　　…　ツール本体（言語別ショートカットあり）
　・Readme.txt　　　　　　　　…　リドミ
　・VMDサイジングWiki　　　　 …　Wikiへのリンク
　・コンテンツツリー用静画　　…　コンテンツツリー用静画へのリンク


----------------------------------------------------------------
■　動作環境
----------------------------------------------------------------

　Windows8.1/10/11 64bit（確認はWindows10のみ）


----------------------------------------------------------------
■　起動
----------------------------------------------------------------

・基本的にはexeをそのまま起動していただければ大丈夫です。

・ログあり版は、出力VMDファイルパスと同じところにログファイルを出力します。

・ファイル履歴は、「history.json」をexeと同じ階層に配置する事でコピー可能です。


----------------------------------------------------------------
■　物理設定機能の使い方
----------------------------------------------------------------

 1. PmxEditor の「ファイル＞PMXデータの状態検証」で「×」ステータスがないことを確認します
    ・特に名称の重複などがあるとPMXの書き出しなどで失敗するリスクが大きくなります

 2. 物理を割り当てしたいメッシュのある材質を確認します
    ・材質の一部にだけ物理を割り当てたい場合、PMXEditorの「編集＞リスト関係＞View選択対象(複数)のリスト選択＞頂点」で頂点の複数選択ができるようにしてから、
      割り当てたい材質頂点を選択して、「右クリック＞CSVファイルへ保存」でCSVに保存してください。
    ・材質を分ける場合、PMXEditorでは「編集＞選択面＞新規材質へ取り出し」を実行してください

 3. PmxTailorを起動します

 4. 対象モデルに 1. のモデルを指定します

 5. 「パラ調整」タブで材質等を設定します
    ・「物理材質」「材質略称」「親ボーン」「剛体グループ」は必須項目です
    ・「物理方向」は袖など左右に物理が流れて欲しい場合などに指定して下さい
    ・スライダーによる材質調整を行うと、「パラ調整（詳細）」タブ内の各パラメーターに反映されます
    ・「パラ調整（詳細）」タブ内の各パラメーターを直接調整する事も可能です
      （ただし「パラ調整（詳細）」パラメーターを調整しても「パラ調整」には反映されません）
    ・「既存設定」を「再利用」で指定した場合、「パラ調整（ボーン）」タブでボーンの並び順を指定する事で、
      既存のボーンとウェイトを再利用して、剛体とジョイントのみ作り直します
    ・「既存設定」を「上書き」で指定した場合、ボーン・剛体・ジョイントを削除して頂点走査を行い物理を割り当てます
    ・裾（ボーンの先の材質）を同じボーンに割り当てたい場合、「裾材質」に材質を指定してください
    ・裏面（基本的に表と同じポリ割りの材質）を同じボーンに割り当てたい場合、「裏面材質」に材質を指定してください
    ・材質の一部にだけ物理を割り当てたい場合、「対象頂点CSV」欄に 1. で保存したCSVファイルを指定してください

 6. 「ファイル」タブの「PmxTailor実行」ボタンをクリックします
    ・複数スリットはスリット単位で物理を割り当てます
    ・同一材質の裾（ポリ割りが変わってる箇所）はボーンを割り当てず、上のボーンでウェイトを割り当てます
    ・裾材質で指定された材質も同様に上のボーンでウェイトを割り当てます
    ・裏面はほぼ同じ位置にある表材質の頂点を割り当てます


----------------------------------------------------------------
■　問題が起きた場合
----------------------------------------------------------------

　・解凍ファイルの文字化け
　・マカフィーでウィルスが入っていると検知されてしまう
　といった問題が起きた場合、下記ページを参照して、解決できるかご確認ください。（VMDサイジングのFAQページです）

　https://github.com/miu200521358/vmd_sizing/wiki/03.-%E5%95%8F%E9%A1%8C%E3%81%8C%E8%B5%B7%E3%81%8D%E3%81%9F%E5%A0%B4%E5%90%88

　それでも解決出来ない場合、コミュニティにてご報告ください。


----------------------------------------------------------------
■　コミュニティのご案内
----------------------------------------------------------------

　ニコニコミュニティ：https://com.nicovideo.jp/community/co5387214

　　VMDサイジングやモーションサポーターなど、自作ツールに関する諸々実験室
　　一足早くβ版を試していただくことができます。
　　サイジングがうまくいかない場合のフォローなども行えたらいいなーと思ってます。
　　一応クローズドですが自動承認なのでお気軽にどうぞ


----------------------------------------------------------------
■　使用条件 他
----------------------------------------------------------------

　《必須事項》

　　・設定した物理の結果を公開・配布する場合は、クレジットの明記のご協力をお願い致します
　　・ニコニコ動画の場合、コンテンツツリーへツリー用静画(im10854784)を登録してください
　　　※コンテンツツリーに親登録していただける場合、クレジット記載は任意です
　　・モデルを不特定多数に配布される場合、配布告知元（動画等）にだけクレジット明記/コンテンツツリー登録をお願いいたします
　　　※該当モデルを使用した作品にクレジット記載を求める必要はありません

　《任意事項》

　　本ツールおよび物理を設定したモデルに関して、元々のモデルの規約の範囲内で、以下の行為は自由に行って下さい

　　・物理の調整・改変
　　　※配布モデルの場合、規約で物理の改変が許可されている事を確認してください
　　・動画投稿サイト、SNS等へのモデル使用動画投稿
　　　・進捗等で生成した物理設定が入ったモデルそのままを投稿することも問題ありません
　　　・ただし、元々のモデルの規約で投稿先や年齢制限等の条件が規定されている場合、このツールで物理を設定したモデルもそれに準じます
　　・物理を設定したモデルの不特定多数への配布
　　　※自作モデルもしくは不特定多数への配布が許可されているモデルのみ

　《禁止事項》

　　本ツールおよび生成したモデルに関して、以下の行為はご遠慮願います

　　・元々のモデル等の規約範囲外の行為
　　・物理の完全自作発言
　　・各権利者様のご迷惑になるような行為
　　・他者の誹謗中傷目的の利用（二次元・三次元不問）

　　・下記条件は禁止事項ではありませんが、ご配慮をお願いいたします
　　　『過度な暴力・猥褻・恋愛・猟奇的・政治的・宗教的表現を含む（R-15相当以上）作品への利用』

　　　・必ず元々のモデル等の規約範囲をご確認の上、ご利用ください
　　　・また作品を公開される際には、検索避け等のご配慮をよろしくお願いいたします

　　※『営利目的の利用』は本ツールにおいては禁止事項ではありませんが、PMXEditorでは禁止事項に当たるためご注意ください

　《免責事項》

　　・自己責任でご利用ください
　　・ツール使用によって生じたいかなる問題に関して、作者は一切の責任を負いかねます


----------------------------------------------------------------
■　ソースコード・ライブラリ
----------------------------------------------------------------

このツールは、pythonで作成しており、以下ライブラリを使用・同梱しています。

・numpy (https://pypi.org/project/numpy/)
・bezier (https://pypi.org/project/bezier/)
・numpy-quaternion (https://pypi.org/project/numpy-quaternion/)
・wxPython (https://pypi.org/project/wxPython/)
・pyinstaller (https://pypi.org/project/PyInstaller/)

ソースコードは、Githubで公開しています。(MITライセンス)
ただし、著作権は放棄しておりません。

https://github.com/miu200521358/pmx_tailor

アイコンは、KindPng様よりお借りしています


----------------------------------------------------------------
■　クレジット
----------------------------------------------------------------

　ツール名：　PmxTailor もしくは Pmxテイラー
　作者：　miu もしくは miu200521358

　http://www.nicovideo.jp/user/2776342
　Twitter: @miu200521358
　Mail: garnet200521358@gmail.com


----------------------------------------------------------------
■　履歴
----------------------------------------------------------------

ver2.01.01(2023/03/16)
■機能追加・変更
・根本頂点推定「リング」を追加
　・メッシュを伸ばしたら縦横の段数が揃った筒状もしくは板状になる場合に有効なメッシュ走査方法
・ボーン密度基準「距離」の計算方法を修正
　・段数全体の平均値から算出
・他材質をグラデーションウェイトに乗せられるよう変更
・「足に繋げる」オプション追加
　・物理中心剛体を足剛体の子どもとするオプション
　　下半身と足の半分より下から物理を始めたい場合（足の動きに物理を合わせたい場合）に有効
・根元の剛体を物理＋ボーン位置合わせから物理に変更
・詳細コメントをフラグでONにできるよう変更
　・一度チェックONにしたら次回からもONになるように履歴保持
・エラーメッセージ追加
　・根元頂点が物理頂点CSVに含まれていない場合
　・物理の下部エッジが見つからなかった場合
　・物理対象CSVが読み込めなかった場合
　・メッシュ走査に失敗した場合
・ジョイントプリセットパラ調整
・詳細タブに「カバー率」オプション追加
　・剛体の縦横を少し広げられる（デフォルト「1.2」）
■不具合修正
・剛体の表示順が頂点マップごとになっていたため修正
・密度基準「中央」の場合の不具合修正
　・ジョイント位置を「ボーン間」に自動設定
　・ウェイト塗りが間違う場合があったので終了
・プリセットを変えた時にジョイント移動データがクリアされなかったのを修正


ver2.01.00(2023/02/18)
■機能追加・変更
　・メッシュ走査・ボーンマッピングロジック変更
　・物理パラ調整
　　・プリセットも調整
　　・プリセット「ウール」を追加
　・不定形なメッシュ用に特殊形状「面欠け」追加
　・ジョイントの位置を「ボーン位置」に置くように変更
　　・パラ調整(詳細)画面の詳細オプションから従来の「ボーン間」に変更可
　・モデルコメントに指定したパラ全ての情報を出力するよう追加
　・ジョイントの横移動制限をボーンの距離に合わせた量に計算するよう修正
■不具合修正
　・下部エッジを検出する際の閾値が全体の中央値になっていたので、上部エッジの中央値に修正
　・縦ジョイントがなかった場合のログを、根元とそれ以降でメッセージを分けるよう修正
　・剛体の向きがおかしくなる場合があるのを修正
　・ウェイト二度塗りを避けるよう、ウェイト塗りの順番を修正
　・再利用で一列だけで布プリセットを使用した場合、横を強制的に参照しようとしてエラーになっていたのを修正

ver2.00.03(2022/11/19)
■機能追加
　・選択されたメッシュの真ん中にのみボーンを張る「密度基準：中央」を追加
　・裾対象頂点CSV欄追加
■不具合修正
　・剛体とジョイントの仮想頂点取得時のチェック追加
　・末端の仮想ボーンを常にメッシュ一行分の幅で生成するよう変更
　・頂点マップ検算時、横の繋がりよりも根元を繋げることを優先するよう変更
　・「密度基準：中央」時のボーンの生成箇所を「奇数 = 真ん中、偶数 = 始点寄り」に変更
　・一枚物メッシュの根元頂点CSV必須チェックを除外
　・縦ジョイント生成に失敗した場合の対処方法追加

ver2.00.02(2022/09/13)
■機能変更
　・PmxEditor0.2.7.3でCSV出力機能のフォーマットがUTF-8になったため、UTF-8でのパースも試行リストに追加
　　※フォーマットは既存同様のもの（汎用用途）のみ想定しています
■不具合修正
　・SDEF＋再利用オプション時にボーンマップ生成に失敗していたのを修正
　・再利用選択時の既存物理削除処理を一旦スルー
　・ジョイント生成時のパラマッピング時INDEX割り当て処理変更

ver2.00.01(2022/07/18)
■不具合修正
　・ジョイントの最小移動制限に不要な値が入っていたため削除

ver2.00.00　（2022/07/18）
　・メッシュ走査方法再構築
　・Vroid2Pmx設定インポート機能追加
　・一枚物の場合には根元頂点CSVを必須とするよう判定追加
　・親ボーンと物理開始地点をウェイトグラデ設定する「物理グラデーション対象頂点CSV」追加
　　・指定された範囲を親ボーンと物理設定対象ボーンの中から近いボーン4つでウェイト生成
　・剛体の厚みオプション追加
　　・デフォルト：根元 0.07、末端 0.2
　・剛体とジョイントの配置を変更
　　・ボーン間：よくある剛体を繋ぐ位置にジョイントを配置するパターン。柔らかいスカート等に向いてる。
　　・ボーン位置：剛体ではなく関節であるボーン位置にジョイントを配置する。逆ジョイントを入れてマントとかに向いてる。
　・頂点ルート探索方法オプション追加
　　・根元頂点優先：（デフォルト）末端から根元への向きを優先（前頂点との内積差は考慮しない）
　　・前頂点優先：前頂点との内積差を加味して、「まっすぐ」を選ぶ
　・根元推定頂点の計算方法オプション追加
　　・角度：末端頂点角度に類似した根元頂点を推定
　　・縮尺: 末端頂点円周と根元頂点円周の縮尺を推定
　・胸物理をN式ベースに変更


ver1.00.02　（2021/12/26）
　・略称設定ENTER押下時に過去設定を再設定するよう機能追加
　・（略称）中心ボーンで該当物理を動かせるよう剛体接続調整
　・密度基準フラグ追加（頂点ベースの場合、一頂点一剛体で生成可能）
　・材質を再選択したときに「パラ調整（ボーン）」タブ内のグリッドがまれに描画がおかしくなる不具合を修正
　・エラーハンドリング追加
　・初期面取得処理調整

ver1.00.01　（2021/12/04）
　・胸プリセット追加
　・画面縦幅を少しだけ拡張（パラ調整タブでスクロールを一番下に持ってきた時に材質名から表示されるように）
　・パラ調整の質量パラメーターの最大値を5 → 10に変更（既存プリセットの挙動は変わらず）
　・既に同一名の剛体が存在していた場合に挙動がおかしくなっていた為、追加剛体に末尾3桁乱数を追加するよう変更
　・モデルコメントの材質パラメーターを一行にまとめるよう変更
　・「パラ調整（詳細）」「パラ調整（ボーン）」タブの材質名に材質略称を追記

ver1.00.00　（2021/12/01）
　　・一般配布開始



